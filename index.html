<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</title>
    <style>
        /* Ù‡Ù…Ù‡ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ */
        body {
            font-family: Tahoma, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: #333;
        }
        .management-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        .btn:hover {
            background: #c0392b;
        }
        .qr-container {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
        }
        .stats {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .tab {
            display: none;
        }
        .tab.active {
            display: block;
        }
        .btn-success {
            background: #27ae60;
        }
        .btn-warning {
            background: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="margin-bottom: 20px;">
            <button class="btn" onclick="showTab('management')">Ù…Ø¯ÛŒØ±ÛŒØª</button>
            <button class="btn" onclick="showTab('wheel')">Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</button>
        </div>

        <div id="management" class="tab active">
            <h1>ğŸ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</h1>
            <p>QR Ú©Ø¯ ÛŒÚ©Ø¨Ø§Ø± Ù…ØµØ±Ù Ø¨Ø±Ø§ÛŒ ØªØ±Ø§Ú©Øª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</p>
            
            <div class="management-panel">
                <button class="btn" onclick="generateQR()">ØªÙˆÙ„ÛŒØ¯ QR Ú©Ø¯ Ø¬Ø¯ÛŒØ¯</button>
                
                <div class="qr-container">
                    <div id="qrCode"></div>
                    <div id="qrInfo"></div>
                </div>
                
                <div class="stats">
                    <h3>ğŸ“Š Ø¢Ù…Ø§Ø±</h3>
                    <p>ØªØ¹Ø¯Ø§Ø¯ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡: <span id="totalCount">0</span></p>
                    <p>ØªØ¹Ø¯Ø§Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡: <span id="usedCount">0</span></p>
                </div>
            </div>
        </div>

        <div id="wheel" class="tab">
            <h1>ğŸ¯ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h1>
            <p>Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ØªØ®ÙÛŒÙ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø±Ùˆ Ø¨Ú†Ø±Ø®Ø§Ù†ÛŒØ¯!</p>
            
            <div style="margin: 20px 0; padding: 20px; background: #ffebee; border-radius: 10px;">
                <p>âš ï¸ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú¯Ø±Ø¯ÙˆÙ†Ù‡ØŒ Ù„Ø·ÙØ§Ù‹ QR Ú©Ø¯ Ø±Ùˆ Ø§Ø² ØªØ¨ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ú©Ù† Ú©Ù†ÛŒØ¯</p>
            </div>
        </div>
    </div>

    <script>
        // Ø³ÛŒØ³ØªÙ… Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ QR Ú©Ø¯
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }

        class QRManager {
            constructor() {
                this.storageKey = 'wheelQRCodes';
                this.init();
            }

            init() {
                if (!localStorage.getItem(this.storageKey)) {
                    localStorage.setItem(this.storageKey, JSON.stringify({
                        qrcodes: {},
                        stats: { total: 0, used: 0 }
                    }));
                }
            }

            getData() {
                return JSON.parse(localStorage.getItem(this.storageKey));
            }

            saveData(data) {
                localStorage.setItem(this.storageKey, JSON.stringify(data));
            }

            generateQR() {
                const data = this.getData();
                const qrId = 'QR_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);
                
                data.qrcodes[qrId] = {
                    id: qrId,
                    used: false,
                    created: new Date().toLocaleString('fa-IR')
                };

                data.stats.total++;
                this.saveData(data);
                
                return qrId;
            }

            getStats() {
                return this.getData().stats;
            }
        }

        const qrManager = new QRManager();

        function generateQR() {
            const qrId = qrManager.generateQR();
            const currentUrl = window.location.href.split('?')[0];
            const qrUrl = currentUrl + '?qr=' + qrId;
            
            document.getElementById('qrCode').innerHTML = '';
            
            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ø±ÙˆÛŒØ³ Ø¢Ù†Ù„Ø§ÛŒÙ† Google Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ QR Ú©Ø¯
            const googleQRUrl = `https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=${encodeURIComponent(qrUrl)}&choe=UTF-8`;
            
            const img = document.createElement('img');
            img.src = googleQRUrl;
            img.width = 200;
            img.height = 200;
            img.alt = 'QR Code';
            img.style.border = '2px solid #333';
            img.style.borderRadius = '10px';
            
            document.getElementById('qrCode').appendChild(img);
            
            document.getElementById('qrInfo').innerHTML = `
                <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 5px;">
                    <p><strong>Ø´Ù†Ø§Ø³Ù‡:</strong> ${qrId}</p>
                    <p><strong>Ù„ÛŒÙ†Ú©:</strong> <br><small>${qrUrl}</small></p>
                    <button class="btn btn-success" onclick="downloadQR()">ğŸ“¥ Ø°Ø®ÛŒØ±Ù‡ QR Ú©Ø¯</button>
                    <button class="btn btn-warning" onclick="printQRSimple()">ğŸ–¨ï¸ Ú†Ø§Ù¾ QR Ú©Ø¯</button>
                </div>
            `;
            
            updateStats();
        }

        function downloadQR() {
            const img = document.querySelector('#qrCode img');
            if (img) {
                const link = document.createElement('a');
                link.download = 'QR-Code-' + Date.now() + '.png';
                link.href = img.src;
                link.click();
            } else {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§ÙˆÙ„ QR Ú©Ø¯ ØªÙˆÙ„ÛŒØ¯ Ú©Ù†ÛŒØ¯');
            }
        }

        function printQRSimple() {
            const img = document.querySelector('#qrCode img');
            if (!img) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§ÙˆÙ„ QR Ú©Ø¯ ØªÙˆÙ„ÛŒØ¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const originalContent = document.body.innerHTML;
            const originalTitle = document.title;
            
            document.body.innerHTML = `
                <div style="text-align: center; font-family: Tahoma; padding: 50px;">
                    <h1>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…Ø§</h1>
                    <h2>QR Ú©Ø¯ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</h2>
                    <img src="${img.src}" style="width: 300px; height: 300px; border: 3px solid #333;">
                    <p>Ø§ÛŒÙ† QR Ú©Ø¯ Ø±Ø§ Ø§Ø³Ú©Ù† Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø± Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ Ø´Ø±Ú©Øª Ú©Ù†ÛŒØ¯</p>
                    <p>ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('fa-IR')}</p>
                    <hr>
                    <small>Ù‡Ø± QR Ú©Ø¯ ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª</small>
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            document.title = originalTitle;
            window.location.reload();
        }

        function updateStats() {
            const stats = qrManager.getStats();
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('usedCount').textContent = stats.used;
        }

        window.onload = updateStats;
    </script>
</body>
    </html>
